<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DataConecta — CRM + Editor Completo</title>

  <!-- Fonts & icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">

  <!-- App stylesheet -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Fabric primary (defer) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.6.0/fabric.min.js" defer></script>

  <style>
    :root { --bg:#f6f7fb; --panel-bg:#fff; --muted:#777; --accent:#4f46e5; font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    html,body { height:100%; margin:0; background:var(--bg); color:#111; }
    .sidebar { width:280px; position:fixed; top:0; left:0; bottom:0; background:#0f1724; color:#fff; padding:20px; box-sizing:border-box; overflow:auto; }
    .sidebar .brand { font-weight:700; font-size:18px; margin-bottom:12px; display:flex; gap:8px; align-items:center; }
    .sidebar nav a { display:block; color:rgba(255,255,255,0.85); padding:10px 8px; text-decoration:none; border-radius:6px; margin-bottom:4px; }
    main.main { margin-left:300px; padding:18px; min-height:100vh; box-sizing:border-box; }
    .topbar { display:flex; justify-content:space-between; gap:12px; margin-bottom:12px; align-items:flex-start; }
    .btn { background:#fff; border:1px solid #e6e6e6; padding:8px 10px; border-radius:6px; cursor:pointer; }
    .btn.primary { background:var(--accent); color:#fff; border:none; }
    .btn.small { padding:6px 8px; font-size:13px; }
    .panel { background:var(--panel-bg); padding:14px; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
    .view-panel { display:block; }
    .hidden { display:none !important; }
    #editor-panel { display:flex; gap:12px; height:calc(100vh - 220px); align-items:stretch; }
    .editor-left { width:320px; background:#fff; border:1px solid #eee; padding:10px; overflow:auto; border-radius:6px; }
    .editor-right { width:320px; background:#fff; border:1px solid #eee; padding:10px; overflow:auto; border-radius:6px; }
    .editor-center { flex:1; display:flex; flex-direction:column; gap:8px; align-items:stretch; }
    #editor-toolbar { display:flex; gap:6px; flex-wrap:wrap; align-items:center; margin-bottom:8px; }
    #canvas-wrap { flex:1; background:linear-gradient(#f7f7f7,#fff); border:1px solid #e6e6e6; border-radius:6px; position:relative; overflow:hidden; display:flex; justify-content:center; align-items:center; }
    #canvas { background:#fff; display:block; }
    .layers-list { list-style:none; padding:0; margin:0; }
    .layers-list li { padding:6px 8px; border-radius:4px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .layers-list li.active { background:#eef2ff; }
    .prop-row { margin-bottom:8px; display:flex; gap:8px; align-items:center; }
    .prop-row label { flex:1; font-size:13px; color:#333; display:flex; gap:8px; align-items:center; }
    .components-library { margin-top:12px; }
    .components-list { display:grid; grid-template-columns: repeat(2, 1fr); gap:8px; }
    .component-card { border:1px solid #eee; border-radius:6px; padding:8px; background:#fafafa; cursor:pointer; display:flex; gap:8px; align-items:center; }
    .component-card img { width:48px; height:48px; object-fit:contain; border-radius:4px; background:#fff; border:1px solid #ddd; }
    .component-card .meta { flex:1; font-size:13px; }
    .component-actions { display:flex; gap:6px; margin-top:8px; }
    .modal { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:9999; width:640px; max-width:95%; }
    .muted { color:var(--muted); }
    .toolbar-section { display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
    .hotspot { position:absolute; border:2px dashed rgba(79,70,229,0.7); pointer-events:none; }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand"><i class="fas fa-database"></i> DataConecta</div>
    <nav>
      <a href="#/dashboard" data-route><i class="fas fa-th-large"></i> Dashboard</a>
      <a href="#/contacts" data-route><i class="fas fa-address-book"></i> Contactos</a>
      <a href="#/companies" data-route><i class="fas fa-building"></i> Empresas</a>
      <a href="#/deals" data-route><i class="fas fa-rocket"></i> Ventas</a>
      <a href="#/communications" data-route><i class="fas fa-envelope"></i> Comunicación</a>
      <a href="#/editor" data-route><i class="fas fa-edit"></i> Editor</a>
      <a href="#/analytics" data-route><i class="fas fa-chart-bar"></i> Analítica</a>
      <a href="#/settings" data-route><i class="fas fa-cog"></i> Ajustes</a>
    </nav>
    <div style="margin-top:18px;color:#bbb;font-size:13px">Demo local — datos en localStorage</div>
  </aside>

  <main class="main">
    <header class="topbar">
      <div>
        <h1 id="page-title">Contactos</h1>
        <p style="color:#777;font-size:1rem;">CRM + Editor: componentes, prototipado y más.</p>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="btn-open-editor" class="btn primary"><i class="fas fa-pencil-ruler"></i> Editor (Pro)</button>
      </div>
    </header>

    <section id="view-container" class="view">
      <div id="view-editor" class="view-panel hidden">
        <div class="panel">
          <h3><i class="fas fa-edit"></i> Editor Avanzado</h3>

          <div id="editor-panel">
            <div class="editor-left panel">
              <h4>Herramientas</h4>
              <div id="editor-toolbar" class="toolbar-section">
                <button id="btn-add-rect" class="btn small" title="Rectángulo"><i class="fas fa-square"></i></button>
                <button id="btn-add-circle" class="btn small" title="Círculo"><i class="fas fa-circle"></i></button>
                <button id="btn-add-line" class="btn small" title="Línea"><i class="fas fa-minus"></i></button>
                <button id="btn-add-text" class="btn small" title="Texto"><i class="fas fa-font"></i></button>

                <button id="btn-upload-image" class="btn small" title="Subir imagen"><i class="fas fa-image"></i></button>
                <input id="editor-image-input" type="file" accept="image/*" style="display:none" />

                <button id="btn-remove-bg" class="btn small" title="Quitar fondo"><i class="fas fa-eraser"></i></button>
                <label style="display:inline-flex;align-items:center;gap:6px;">
                  <span style="font-size:12px;color:#555">Tolerancia</span>
                  <input id="bg-tolerance" type="range" min="5" max="120" value="32" style="width:120px">
                </label>

                <button id="btn-duplicate" class="btn small" title="Duplicar"><i class="fas fa-clone"></i></button>
                <button id="btn-group" class="btn small" title="Agrupar"><i class="fas fa-object-group"></i></button>
                <button id="btn-ungroup" class="btn small" title="Desagrupar"><i class="fas fa-object-ungroup"></i></button>

                <button id="btn-undo" class="btn small" title="Deshacer"><i class="fas fa-rotate-left"></i></button>
                <button id="btn-redo" class="btn small" title="Rehacer"><i class="fas fa-rotate-right"></i></button>
              </div>

              <hr/>

              <h4>Component Library</h4>
              <div style="display:flex;gap:6px;align-items:center;margin-bottom:8px;">
                <button id="btn-create-component" class="btn small">Create component</button>
                <button id="btn-open-library" class="btn small">Open library</button>
              </div>

              <div class="components-library">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <strong>Library</strong>
                  <button id="btn-refresh-components" class="btn tiny">Refresh</button>
                </div>
                <div id="components-preview" class="components-list" style="margin-top:8px"></div>
                <div class="component-actions" style="margin-top:8px">
                  <button id="btn-insert-component" class="btn small">Insert</button>
                  <button id="btn-detach-instance" class="btn small">Detach</button>
                  <button id="btn-update-component" class="btn small">Update comp</button>
                </div>
              </div>

              <hr/>
              <h4>Páginas / Artboards</h4>
              <div style="display:flex;gap:6px;align-items:center;margin-bottom:8px;">
                <select id="device-select" class="btn small" style="padding:6px 8px"></select>
                <button id="btn-add-artboard-from-preset" class="btn small">Nueva página</button>
                <button id="btn-new-page" class="btn tiny">+Quick</button>
              </div>
              <div id="pages-list" style="max-height:200px;overflow:auto"></div>

            </div>

            <div class="editor-center panel">
              <div style="display:flex; gap:8px; align-items:center;">
                <div style="font-size:13px;color:#555">Zoom: <span id="zoom-level">100%</span></div>
                <div style="flex:1"></div>
                <div style="font-size:13px;color:#555">Seleccionado: <span id="sel-summary">Ninguno</span></div>
              </div>

              <div id="canvas-wrap" ondrop="return false" ondragover="event.preventDefault()">
                <canvas id="canvas"></canvas>
              </div>

              <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
                <button id="btn-fit" class="btn small">Ajustar</button>
                <button id="btn-toggle-grid" class="btn small">Grid</button>
                <button id="btn-export-png" class="btn small">Export PNG</button>
                <button id="btn-export-svg" class="btn small">Export SVG</button>

                <div style="flex:1"></div>

                <button id="btn-create-link" class="btn small">Create link</button>
                <button id="btn-play-prototype" class="btn small">Play prototype</button>
                <button id="btn-stop-prototype" class="btn small">Stop</button>
              </div>
            </div>

            <div class="editor-right panel">
              <h4>Propiedades</h4>
              <div class="prop-row">
                <label>Tipo / Texto <input id="prop-text" placeholder="Texto o tipo" /></label>
              </div>
              <div class="prop-row">
                <label>Color <input id="prop-fill" type="color" value="#111827" /></label>
              </div>
              <div class="prop-row">
                <label>Stroke <input id="prop-stroke" type="color" value="#000000" /></label>
              </div>
              <div class="prop-row">
                <label>Tamaño fuente <input id="prop-fontsize" type="number" min="6" max="144" value="18" /></label>
              </div>
              <div class="prop-row">
                <label>Ancho <input id="prop-width" type="number" min="1" /></label>
                <label>Alto <input id="prop-height" type="number" min="1" /></label>
              </div>
              <div class="prop-row">
                <label>Rotación <input id="prop-angle" type="number" step="1" /></label>
              </div>
              <div class="prop-row">
                <label>Opacidad <input id="prop-opacity" type="range" min="0" max="1" step="0.01" value="1" /></label>
              </div>

              <hr/>
              <h4>Capas</h4>
              <ul id="layers-list" class="layers-list"></ul>

              <hr/>
              <h4>Component Actions</h4>
              <div style="display:flex;gap:6px;flex-direction:column;">
                <button id="btn-show-library-modal" class="btn small">Open Library (full)</button>
                <button id="btn-export-library" class="btn small">Export library JSON</button>
                <button id="btn-import-library" class="btn small">Import library</button>
                <input id="component-import-file" type="file" accept="application/json" style="display:none" />
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Other views (placeholder) -->
      <div id="view-contacts" class="view-panel hidden"><div class="panel"><h3>Contactos</h3></div></div>
      <div id="view-dashboard" class="view-panel hidden"><div class="panel"><h3>Dashboard</h3></div></div>
      <div id="view-placeholder" class="view-panel hidden"><div class="panel"><h3>Próximamente</h3></div></div>
    </section>

    <footer class="footer">DataConecta — Demo local. Los datos se guardan en localStorage.</footer>
  </main>

  <!-- Library Modal -->
  <div id="library-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="panel">
      <h3>Component Library</h3>
      <div id="library-list" style="max-height:420px;overflow:auto;display:grid;grid-template-columns:repeat(3,1fr);gap:8px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button id="lib-close" class="btn">Cerrar</button>
      </div>
    </div>
  </div>

  <input id="file-import" type="file" accept="application/json" class="hidden"/>

  <script>
    (function () {
      function showViewByHash() {
        const hash = location.hash.replace(/^#/, '') || '/dashboard';
        const route = hash.replace(/^\//, '').split('?')[0];
        const targetId = 'view-' + (route || 'dashboard');
        document.querySelectorAll('.view-panel').forEach(v => v.classList.add('hidden'));
        const target = document.getElementById(targetId);
        if (target) {
          target.classList.remove('hidden');
          const titleMap = { 'dashboard':'Dashboard', 'contacts':'Contactos', 'editor':'Editor' };
          const pageTitle = document.getElementById('page-title');
          if (pageTitle) pageTitle.textContent = titleMap[route] || pageTitle.textContent;
        } else {
          const placeholder = document.getElementById('view-placeholder');
          if (placeholder) placeholder.classList.remove('hidden');
        }
      }
      document.addEventListener('click', function (e) {
        const a = e.target.closest && e.target.closest('[data-route]');
        if (!a) return;
        e.preventDefault();
        const href = a.getAttribute('href') || '#/dashboard';
        location.hash = href.replace(/^#/, '');
      });
      window.addEventListener('hashchange', showViewByHash);
      document.addEventListener('DOMContentLoaded', showViewByHash);
    })();
  </script>

  <script src="js/editor.js" defer></script>
</body>
</html>
