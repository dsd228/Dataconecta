<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DataConecta — Shell</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">
  <style>
    :root{ --bg:#0f1724; --card:#0b1220; --accent:#4f46e5; --muted:#9aa4b2; font-family:Inter,system-ui,Arial, sans-serif; color:#e6eef6; }
    html,body{ height:100%; margin:0; background:linear-gradient(180deg,#061226 0%, #07182b 100%); }
    .shell{ display:flex; height:100vh; gap:24px; padding:36px; box-sizing:border-box; align-items:center; justify-content:center; }
    .panel{ background:rgba(255,255,255,0.03); border-radius:14px; padding:28px; width:100%; max-width:1100px; box-shadow: 0 10px 30px rgba(2,6,23,0.6); }
    .hero{ display:flex; gap:24px; align-items:center; }
    .hero-left{ flex:1; }
    .title{ font-size:28px; margin:0 0 8px 0; color:#fff; }
    .subtitle{ margin:0 0 18px 0; color:var(--muted); }
    .modules{ display:flex; gap:12px; flex-wrap:wrap; }
    .module-card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:16px; border-radius:10px; min-width:220px; cursor:pointer; transition:transform .12s; }
    .module-card:hover{ transform:translateY(-6px); box-shadow: 0 8px 30px rgba(0,0,0,0.5); }
    .module-card h3{ margin:0 0 6px 0; color:#fff; }
    .module-card p{ margin:0; color:var(--muted); font-size:13px; }
    #app-root{ margin-top:24px; }
    nav.shell-nav{ display:flex; gap:8px; justify-content:center; margin-top:18px; }
    .btn{ background:var(--accent); color:#fff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }
    footer{ text-align:center; color:var(--muted); margin-top:18px; font-size:13px; }
  </style>
</head>
<body>
  <div class="shell">
    <div class="panel">
      <div class="hero">
        <div class="hero-left">
          <h1 class="title">DataConecta</h1>
          <p class="subtitle">CRM · UX Editor · Analítica — Plataforma integrada. Pulsa un módulo para abrirlo.</p>

          <div class="modules" role="navigation" aria-label="Módulos">
            <div class="module-card" id="open-crm" role="button" tabindex="0" aria-pressed="false">
              <h3><i class="fas fa-address-book"></i> CRM & Marketing</h3>
              <p>Gestiona contactos, empresas, deals, campañas y comunicaciones.</p>
            </div>

            <div class="module-card" id="open-editor" role="button" tabindex="0" aria-pressed="false">
              <h3><i class="fas fa-pencil-ruler"></i> Editor UX/UI</h3>
              <p>Diseña pantallas, componentes y prototipos con artboards y export.</p>
            </div>

            <div class="module-card" id="open-analytics" role="button" tabindex="0" aria-pressed="false">
              <h3><i class="fas fa-chart-line"></i> Analítica</h3>
              <p>Recolección, informes, predicción, embudos y conectores (BigQuery, Ads).</p>
            </div>
          </div>

          <nav class="shell-nav" aria-label="Acciones rápidas">
            <button class="btn" id="btn-open-crm">Abrir CRM</button>
            <button class="btn" id="btn-open-editor-shell">Abrir Editor</button>
            <button class="btn" id="btn-open-analytics-shell">Abrir Analítica</button>
          </nav>

        </div>
        <div class="hero-right" style="width:360px;">
          <div style="background:rgba(255,255,255,0.02); padding:16px; border-radius:10px;">
            <strong>Estado</strong>
            <p style="color:var(--muted); margin-top:8px;">Módulos cargados dinámicamente: CRM, Editor UX/UI y Analítica. Cada módulo es independiente y puede exponer init() / destroy().</p>
          </div>
        </div>
      </div>

      <div id="app-root" aria-live="polite"></div>

      <footer>DataConecta — Shell (mascara) — dsd228</footer>
    </div>
  </div>

  <script>
    // Module loader: lazy loads HTML fragment + CSS + JS and calls moduleAPI.init(params)
    window.__currentModule = null;

    async function loadModule({ name, html, js, css, params = {} }) {
      const container = document.getElementById('app-root');
      if (!container) throw new Error('No app root');
      // destroy previous
      if (window.__currentModule && window.__currentModule.apiName) {
        try { window[window.__currentModule.apiName]?.destroy?.(); } catch(e){ console.warn('destroy error', e); }
        container.innerHTML = '';
      }
      // load HTML
      const resp = await fetch(html, { cache: 'no-cache' });
      if (!resp.ok) throw new Error('Failed to load module HTML: ' + html);
      const htmlText = await resp.text();
      container.innerHTML = htmlText;
      // load css
      if (css && !document.querySelector(`link[data-module="${name}"]`)) {
        const link = document.createElement('link');
        link.rel = 'stylesheet'; link.href = css; link.setAttribute('data-module', name);
        document.head.appendChild(link);
      }
      // load js
      if (js && !document.querySelector(`script[data-module="${name}"]`)) {
        await new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = js; s.async = true; s.setAttribute('data-module', name);
          s.onload = () => resolve();
          s.onerror = (e) => reject(new Error('Failed to load module script: ' + js));
          document.body.appendChild(s);
        });
      }
      // set current
      const apiName = name + 'API';
      window.__currentModule = { name, apiName };
      // init
      if (window[apiName] && typeof window[apiName].init === 'function') {
        try { await window[apiName].init(params); } catch (err) { console.error('module init failed', err); }
      } else {
        console.warn(`${apiName}.init not found`);
      }
    }

    // bind UI triggers
    document.getElementById('open-crm')?.addEventListener('click', () => loadModule({ name:'crm', html:'modules/crm.html', js:'modules/crm.js', css:'modules/crm.css' }));
    document.getElementById('open-editor')?.addEventListener('click', () => loadModule({ name:'editor', html:'modules/editor.html', js:'modules/editor.js', css:'modules/editor.css' }));
    document.getElementById('open-analytics')?.addEventListener('click', () => loadModule({ name:'analytics', html:'modules/analytics.html', js:'modules/analytics.js', css:'modules/analytics.css' }));

    document.getElementById('btn-open-crm')?.addEventListener('click', () => document.getElementById('open-crm').click());
    document.getElementById('btn-open-editor-shell')?.addEventListener('click', () => document.getElementById('open-editor').click());
    document.getElementById('btn-open-analytics-shell')?.addEventListener('click', () => document.getElementById('open-analytics').click());
  </script>
</body>
</html>
